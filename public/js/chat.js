(()=>{const e=new EmojiConvertor;new EmojiPicker,e.init_env();const o=new Map,t=o=>{const t=document.createElement("p"),n=(e=>{const o=document.createElement("span");return o.className="username",o.style.color=`#${e.color}`,o.textContent=`${e.username}: `,o})(o);t.appendChild(n);const r=(new DOMParser).parseFromString(e.replace_emoticons(o.message),"text/html");for(let e of Object.values(r.body.childNodes))e.className&&e.className.includes("emoji")&&""===e.innerHTML?t.appendChild(e):t.appendChild(document.createTextNode(e.textContent));return t.className="message",t},n=e=>{const o=document.createElement("div");o.style.backgroundColor=`#${e.color}30`;const n=t(e);o.appendChild(n);const r=document.querySelector("#messages");r.appendChild(o),r.scrollTop=r.scrollHeight},r=e=>{const t=document.createElement("p");t.textContent=e.username,t.className="username",t.style.color=`#${e.color}`,document.querySelector("#users").appendChild(t),o.set(e.username,{color:e.color,el:t})},s=io();s.on("message",n),s.on("user connected",r),s.on("user disconnected",e=>{document.querySelector("#users").removeChild(o.get(e.username).el)}),s.on("recover messages",e=>{e=e.reverse();for(let o of e)n(o)}),s.on("recover users",e=>{for(let o of e)r(o)}),s.on("err",e=>{console.error(e)}),s.on("disconnect",()=>{const e=document.querySelector("h1");e.className="red-text",e.textContent="Elija otro nombre de usuario",window.onbeforeunload=null,setTimeout(()=>location.reload(),2e3)}),document.querySelector("form").addEventListener("submit",function(e){e.preventDefault();const o=this.querySelector("#message"),t=o.value.trim();if(0===t.length)return c("Escribe un mensaje");if(t.length>=100)return c("El mensaje debe tener menos de 100 caracteres");if("%exit"===t){let e=history.length;return window.onbeforeunload=null,history.go(1-e)}return s.emit("message",t),o.value="",!1}),window.onbeforeunload=(()=>!0);const c=e=>{UIkit.notification(e,{status:"danger",pos:"bottom-center"})};s.io._reconnectionDelay=2e3,s.io._timeout=5e3})();